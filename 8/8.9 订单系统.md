## 8.8 订单系统

一个交易系统，用户向商家下单买东西， 用户会查自己的订单，商家也会查自己的订单，查询范围都是近三个月， 订单量每天2000w，请问如何设计业务系统满足这个需求

分库分表是一定的， 我想到的是做数据冗余，三个表（每个表做水平分库分表），订单表随机分，用户测订单表按用户切分，商户测订单表按商户切分

订单的新id生成全局唯一并增长，且要保证个分片均匀分布，这样每个分片的插入效率都很高，也没有数据倾斜

老数据也便于归档

用户侧和商户侧的数据只有部分必要的，用于列表呈现，筛选，聚合运算用的信息，核心订单表存订单的完整状态，任何时候都以核心订单表为准

用户侧，商户侧订单表采用队列同步机制更新，只保证最终一致性